## RedBookX

项目描述：该项目是一个仿小红书的社区系统，提供笔记发布、点赞、收藏、关注等社交互动功能。平台针对海量用户的高并发访问场景进行了优化，通过引入分布式架构与缓存机制，实现高可用、高扩展性和高性能的服务。系统同时注重数据一致性与实时响应，保障用户操作体验的稳定与流畅

项目架构：微服务分布式架构 + Maven 多模块 + Spring Boot Starter 组件 

## 技术栈

Spring Cloud Alibaba + Nacos + Gateway + Feign + Mybatis + MySQL + Redis + RocketMQ + SaToken + Minio + Cassandra + Zookeeper

## 主要内容

1：平台设计：主导平台从 0 到 1 的系统建设，负责整体需求梳理、技术选型、架构设计、项目搭建以及接口与数据库表结构设计。通过微服务化与分布式架构的实施，确保系统具备高可用、高性能及高扩展能力，可稳定支撑海量用户的并发访问与实时操作

2：组件和工具类封装：参与多个通用功能模块的组件化与抽象设计，构建了高复用、高内聚的基础组件体系。通过封装用户上下文组件、接口切面日志组件、Jackson 自动化配置组件、全局异常捕获机制、自定义参数校验注解及统一响应工具类等模块，显著提升了系统的开发效率与维护性，为后续业务快速迭代提供了稳定的底层支撑

3：服务拆分：依据业务领域和职责边界对系统进行微服务化拆分，设计并实现网关服务、认证服务、用户服务、笔记服务、用户关系服务、计数服务、OSS 对象存储服务、分布式 ID 生成服务以及 KV 短文本键值存储服务等核心模块。通过单一职责原则与服务解耦设计，实现各微服务的独立部署、独立维护与水平扩展，提升系统的可扩展性与稳定性

4：网关服务：负责 Gateway 网关服务的设计与实现，构建统一的路由与负载均衡体系。通过集成 Sa-Token 完成网关层的统一鉴权与会话管理；在全局过滤器中解析 Token 信息，并将用户 ID 等关键信息透传至下游服务，实现高效、安全的请求转发与身份传递

5：认证服务：负责认证服务模块的设计与实现，采用 RBAC 模型进行权限控制，基于 Sa-Token 构建 JWT 登录认证体系，支持账号登录、手机号验证码登录、登出、自注册及密码修改等功能。集成阿里云 SMS 服务，通过自定义线程池实现验证码短信的异步发送，并设计防刷策略，有效防止恶意请求与短信滥发，提升系统安全性与稳定性

6：分布式 ID 生成服务：负责分布式 ID 生成服务的搭建与性能优化，基于美团 Leaf 源码进行深度整合，封装为独立可复用组件。服务通过 Feign 接口对外提供号段模式与雪花算法两种高性能 ID 生成方式。经 JMeter 压测验证，单节点吞吐量达 22,000+ 次/秒，平均响应耗时仅 4 ms，可稳定支撑日均 19 亿+ 次 ID 请求，为系统高并发场景下的数据唯一性与可扩展性提供保障

7：OSS 对象存储服务：负责对象存储服务模块的设计与实现，主要用于管理图片、视频等非结构化数据。通过工厂模式与策略模式结合，构建可扩展的文件存储架构，目前已支持阿里云 OSS 与 MinIO 两种实现方式。结合 Nacos 分布式配置中心，实现文件策略实现类 Bean 的动态注册与加载，使系统在运行时可灵活切换存储策略，满足多云与本地混合部署场景

8：KV 短文本键值存储服务：负责 KV 键值存储服务的开发，基于 RocksDB 构建 Apache Cassandra，实现短文本数据（如笔记正文、评论内容）的高性能存储与检索。系统支持大规模数据的高并发读写，确保数据访问的低延迟与高可用性，为平台核心业务提供稳定可靠的底层存储支撑

9：用户服务：负责用户服务模块的设计与开发，实现用户信息管理，包括注册、查询、信息更新及密码修改（采用 BCrypt 随机盐加密）。通过 Redis + Caffeine 本地缓存构建二级缓存体系，为外部接口提供高并发查询能力，同时有效防止缓存雪崩、缓存穿透和缓存击穿，保证系统稳定性与性能

10：笔记服务：负责笔记服务模块的设计与开发，实现用户笔记的全生命周期管理，包括发布、编辑、查询、置顶以及权限控制等功能，确保数据一致性与操作的高可用性 <br />
（1）：利用 CompletableFuture 实现下游服务的并发调用，从而降低接口响应延迟。同时，结合二级缓存体系优化笔记详情查询，提升高并发访问场景下的系统性能与稳定性 <br/>
（2）：负责笔记更新与删除操作的缓存一致性方案设计，采用 RocketMQ 广播服务，在集群环境中实时通知各节点清理本地缓存，确保分布式系统中缓存与数据库数据保持高度一致，有效防止脏数据及缓存失效问题 <br />
（3）：负责点赞接口高并发优化方案设计：使用 Redis Bloom 过滤器实现高性能用户点赞状态判断；结合 Redis ZSET + MQ 实现异步落库，消费者端通过 RateLimiter 令牌桶算法对写入流量进行削峰处理，确保在高并发环境下数据库稳定、安全，同时保持系统低延迟和高可用性 <br />

11：用户关系服务：负责设计和实现用户关系服务 <br />
（1）：负责用户关注与取关功能设计与实现，支持高并发社交操作并维护完整的用户关系链。通过 Redis 缓存 + 顺序消息 MQ 实现异步写入，确保操作顺序与接口响应性能；利用 Lua 脚本优化 Redis 操作，保障多次操作的原子性和系统性能；消费者端通过联合唯一索引确保关系记录的幂等性，实现高并发环境下数据一致性和系统稳定性 <br />
（2）：粉丝列表和关注列表查询：利用 Redis ZSET 数据结构，对两种不同类型的列表应用各自的缓存策略，以缓存热点数据。此方案提升了分页查询的高并发读能力，确保系统在大规模访问场景下仍具备低延迟和高吞吐量 <br />

12：计数服务：负责高并发计数服务的设计与实现，支撑平台用户关注、粉丝、点赞等多种计数需求。服务采用优化的数据结构与并发处理策略，在海量用户互动场景下保证高性能、低延迟与高可用性，为系统实时统计和分析提供稳定支撑 <br />
（1）：消费者通过消费用户行为消息队列（MQ）中的操作（关注、取关等），利用 BufferTrigger 对流量进行聚合，例如每 1000 条或每 1 秒批量处理一次。计数数据先写入 Redis 缓存，再异步通过削峰机制落库，从而在高并发写入场景下保证系统性能与数据一致性 <br />

13：数据对齐服务：负责计数服务的架构设计与实现，结合补偿策略处理异步写入及异常操作，保证计数结果在分布式系统中的最终一致性，提高系统可靠性与数据准确性 <br />
（1）：通过 XXL-Job 定时调度任务，自动预创建各维度的日增量计数变更记录表。消费者端消费 MQ 消息，将当天发生的计数变更数据持久化到对应表中，实现计数数据的高效记录与管理 <br />
（2）：设计并实现分片广播任务机制，将大数据量处理任务拆分为多个分片并行执行，显著提升处理效率，确保凌晨计数对齐任务在高数据量环境下按时高效完成 <br />

14：搜索服务：<br />
（1）：负责笔记和用户索引的设计与实现，利用 Logstash 构建全量索引，实现数据的高效同步与更新，显著提升搜索查询性能，为平台提供稳定可靠的索引服务 <br />
（2）：负责 MySQL 数据变更的实时同步方案，结合 Canal 监听 Binlog，自定义事件处理逻辑，将笔记和用户数据增量同步至 Elasticsearch 构建实时索引。该方案确保数据库与搜索引擎数据一致性，同时满足高并发下的索引实时更新需求 <br />
（3）：负责笔记与用户搜索接口开发，支持中文分词、关键词高亮、维度条件筛选及自定义文档评分，实现高精度搜索体验。通过优化索引和查询策略，提升系统在高并发下的搜索性能与响应速度 <br />

15：评论服务：<br />
（1）：表设计与数据冗余：针对评论查询性能优化，设计冗余字段存储关键评论信息，包括最早回复的评论 ID 及子评论计数，减少多表关联查询开销，实现高并发访问下的快速数据检索与响应 <br />
（2）：MQ 生产者可靠性设计：负责 MQ 消息可靠投递方案设计，利用 Spring Retry 实现消息自定义重试机制，并结合兜底写库与异步失败消息处理，确保在高并发及异常场景下消息最终成功送达，提高系统的可靠性与可用性 <br />
（3）：评论发布功能开发：设计并实现高性能异步评论发布接口，支持评论内容的持久化存储，同时触发相关异步操作，包括评论热度计算和评论总数更新，确保数据一致性和系统响应速度 <br />
（4）：批量消费与写入优化：负责评论数据处理优化方案，消费端批量消费 MQ 消息，并通过批量写入数据库显著提升写入吞吐量，有效优化高并发场景下评论数据的处理效率，确保系统的稳定性与高性能 <br />
（5）：评论分页查询：负责一级、二级评论分页查询功能开发，通过 Redis 与本地缓存构建二级缓存体系，提升高并发访问场景下的查询性能与响应速度，同时降低数据库负载，保证系统稳定性 <br />
（6）：评论点赞，取消点赞，删除功能：针对评论点赞与取消点赞操作，通过 MQ 异步处理、批量消费和批量写库机制，结合内存操作合并策略，实现高并发场景下点赞数据的高性能写入，保障系统稳定性与数据一致性 <br />



